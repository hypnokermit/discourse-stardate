<script type="text/discourse-plugin" version="0.8">
  function isLeapYear(year) { return ((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0); }
  
  function getStardate(today = new Date()) {
    var year = today.getFullYear();
    year += 399;						// Adjust for Argo's Timeline
    var month = today.getMonth();
    var day = today.getDate();
    var hour = today.getHours();
    var minute = today.getMinutes();
    var second = today.getSeconds();
	
    var xday = 365;
    var DayArray = new Array(0,31,59,90,120,151,181,212,243,273,304,334);
	
    if(isLeapYear(year)) {
      xday = 366;
      DayArray.splice(0,12,0,31,60,91,121,152,182,213,244,274,305,335);
    }
	
    var DayOfYear = DayArray[month] + day - 1;
	
    var earthdate = year + ((DayOfYear + (hour / 24) + (minute / 1440) + (second / 86400)) / xday);
    var stardate = 1000 * (earthdate - 2323);
    stardate = Math.round(stardate * 10) / 10;
	
    return stardate;
  }
  
  $(document).ready(function() {
    let currentLocale = I18n.currentLocale(); 
    I18n.translations[currentLocale].js.title_stardate = "Insert Current Stardate";
  });
  
  api.addToolbarPopupMenuOptionsCallback(() => {
  return {
      action: "underline",
      icon: "underline",
      label: "underline_button"
  };
});

api.modifyClass("controller:composer", {
  actions: {
    underline() {
      this.get("toolbarEvent").applySurround('[u]', '[/u]', "underline_text");
    },
    floatleft() {
      this.get("toolbarEvent").applySurround('[wrap="floatl"]\n', '\n[/wrap]', "float_left_text");
    },
    columns() {
      this.get("toolbarEvent").applySurround('[wrap="columns"]\n', '\n[/wrap]', "columns_text");
    }
  }
});
  
</script>
